1ï¸âƒ£ é©±åŠ¨å®‰è£…ä¸æ£€æµ‹

Ubuntu é»˜è®¤å¸¦ ALSA é©±åŠ¨ï¼Œå¤§éƒ¨åˆ†å£°å¡å’Œ USB è€³æœºå³æ’å³ç”¨ã€‚
å¦‚æœæ˜¯å®šåˆ¶ç¡¬ä»¶æˆ–æ— å£°å¡ï¼Œéœ€æ‰‹åŠ¨å®‰è£…ï¼š
sudo apt update
sudo apt install alsa-base alsa-utils linux-sound-base -y
æ£€æµ‹å£°å¡ï¼š
lspci | grep -i audio   # PCI å£°å¡
lsusb | grep -i audio   # USB éŸ³é¢‘è®¾å¤‡
åˆ—å‡ºå¯ç”¨è®¾å¤‡ï¼š
aplay -l    # æ’­æ”¾è®¾å¤‡
arecord -l  # å½•éŸ³è®¾å¤‡
ğŸ“Œ å¦‚æœè¾“å‡ºé‡Œèƒ½çœ‹åˆ° card 0ã€device 0 ä¹‹ç±»ï¼Œè¯´æ˜é©±åŠ¨åŠ è½½æˆåŠŸã€‚
2ï¸âƒ£ å®‰è£… PipeWire éŸ³é¢‘æœåŠ¡

Ubuntu 24 é»˜è®¤ä½¿ç”¨ PipeWireï¼Œå»ºè®®ç²¾ç®€å®‰è£…ï¼š
sudo apt install --no-install-recommends \
    pipewire wireplumber pipewire-audio-client-libraries -y

ç¦ç”¨ PulseAudioï¼Œé¿å…å†²çªï¼š
systemctl --user mask pulseaudio
systemctl --user stop pulseaudio.socket pulseaudio.service

å¯ç”¨ PipeWireï¼š
systemctl --user enable --now pipewire pipewire-pulse wireplumber

éªŒè¯ï¼š
pactl info | grep "Server Name"

è¾“å‡ºåº”ä¸ºï¼š
Server Name: PulseAudio (on PipeWire 0.3.x)

å®‰è£… FreeRDP
sudo apt install freerdp2-x11 freerdp2-wayland freerdp2-shadow-cli -y

4ï¸âƒ£ æœ¬åœ°éŸ³é¢‘æµ‹è¯•

æµ‹è¯•æ’­æ”¾ï¼š
speaker-test -t sine -f 440 -D default -c 2

æµ‹è¯•å½•éŸ³ï¼š
arecord -f cd test.wav
aplay test.wav

FreeRDP éŸ³é¢‘æµå¼è½¬å‘

è¿œç«¯å£°éŸ³ â†’ æœ¬åœ°æ’­æ”¾
xfreerdp /v:<server_ip> /u:<username> /p:<password> /sound:sys:pipewire
æœ¬åœ°éº¦å…‹é£ â†’ è¿œç«¯è¾“å…¥
xfreerdp /v:<server_ip> /u:<username> /p:<password> /microphone:sys:pipewire

åŒå‘æµå¼éŸ³é¢‘

xfreerdp /v:<server_ip> /u:<username> /p:<password> \
  /sound:sys:pipewire /microphone:sys:pipewire

ğŸ¯ å£°éŸ³é‡å®šå‘åˆ° ThinClient çš„æœºåˆ¶
1ï¸âƒ£ Windows Server â†’ ThinClient

FreeRDP é»˜è®¤æ”¯æŒ RDP Audio Redirection åè®®ï¼š

Windows çš„ç³»ç»Ÿå£°éŸ³ / åº”ç”¨å£°éŸ³ ä¼šè¢«ç¼–ç ï¼ˆRDP-PCM/WAV/AACï¼‰

é€šè¿‡ RDP é€šé“ä¼ è¾“åˆ°å®¢æˆ·ç«¯

ThinClientï¼ˆxfreerdpï¼‰è§£ç  â†’ PipeWire/ALSA æ’­æ”¾

ğŸ‘‰ åœ¨ ThinClient å¯åŠ¨ FreeRDP æ—¶åŠ ä¸Šï¼š

xfreerdp /v:<server_ip> /u:<username> /p:<password> /sound:sys:pipewire


è¿™æ · è¿œç«¯ Windows çš„å£°éŸ³ å°±ä¼šç›´æ¥æ’­æ”¾åœ¨ ThinClient æœ¬åœ°ã€‚
ï¼ˆå¦‚æœä¸æŒ‡å®š sys:pipewireï¼Œä¹Ÿå¯ä»¥ç”¨ sys:pulse æˆ– sys:alsaï¼Œä½† Ubuntu24 æ¨è pipewireï¼‰

2ï¸âƒ£ Linux Server â†’ ThinClient

Linux ç«¯æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸º RDP å¹¶ä¸æ˜¯ Linux åŸç”Ÿåè®®ã€‚å¸¸è§å‡ ç§æ–¹å¼ï¼š

ğŸ”¹ (A) ä½¿ç”¨ xrdp

åœ¨ Linux Server å®‰è£… xrdpï¼š

sudo apt install xrdp pulseaudio-module-xrdp


å¯åŠ¨æœåŠ¡ï¼š

sudo systemctl enable --now xrdp


ThinClient ç«¯ç”¨ FreeRDP è¿æ¥ï¼š

xfreerdp /v:<linux_server_ip> /u:<username> /p:<password> /sound:sys:pipewire


ğŸ‘‰ å£°éŸ³ä¼šé€šè¿‡ PulseAudio â†’ xrdp éŸ³é¢‘é€šé“ â†’ RDP â†’ ThinClientã€‚

ğŸ”¹ (B) ä½¿ç”¨ PulseAudio ç½‘ç»œä¼ è¾“

å¦‚æœä¸ç”¨ RDPï¼Œä»…ä»…è¦æŠŠ Linux Server çš„å£°éŸ³è½¬åˆ° ThinClientï¼Œå¯ä»¥ç›´æ¥ç”¨ PulseAudio çš„ç½‘ç»œæ¨¡å—ï¼š

Linux Server ç«¯ï¼š

pactl load-module module-native-protocol-tcp auth-ip-acl=<thinclient_ip>


ThinClient ç«¯ï¼š

export PULSE_SERVER=<server_ip>
paplay /usr/share/sounds/alsa/Front_Center.wav


ğŸ‘‰ æ‰€æœ‰å£°éŸ³ä¼šè¢«è½¬å‘åˆ° ThinClient çš„ PipeWire/PulseAudio æ’­æ”¾ã€‚

ğŸ”¹ (C) ä½¿ç”¨ GStreamer / RTP / WebRTC

é€‚åˆå®æ—¶éŸ³é¢‘æµè½¬å‘åœºæ™¯ï¼Œä¾‹å¦‚å¤šåª’ä½“æ’­æ”¾ã€è¿œç¨‹æ•™å­¦ï¼š

# Server ç«¯æ¨é€
gst-launch-1.0 pulsesrc ! audioconvert ! audioresample ! opusenc ! rtpopuspay ! udpsink host=<thinclient_ip> port=5000

# ThinClient ç«¯æ¥æ”¶
gst-launch-1.0 udpsrc port=5000 caps="application/x-rtp" ! rtpopusdepay ! opusdec ! audioconvert ! audioresample ! autoaudiosink

3ï¸âƒ£ éªŒè¯å£°éŸ³é‡å®šå‘
Windows Server éªŒè¯

åœ¨è¿œç«¯ Windows æ’­æ”¾ä¸€ä¸ªè§†é¢‘

å£°éŸ³åº”è¯¥ç›´æ¥å‡ºç°åœ¨ ThinClient

Linux Server (xrdp) éªŒè¯

åœ¨è¿œç«¯ Linux æ’­æ”¾æµ‹è¯•éŸ³é¢‘ï¼š

paplay /usr/share/sounds/alsa/Front_Center.wav


ç¡®è®¤ ThinClient èƒ½å¬åˆ°å£°éŸ³

PulseAudio ç½‘ç»œéªŒè¯

åœ¨ Linux Server æ’­æ”¾å£°éŸ³ï¼ŒThinClient ä½œä¸ºè¾“å‡ºè®¾å¤‡

pavucontrol å¯ä»¥çœ‹åˆ°éŸ³é¢‘æµ

ğŸ“ æ€»ç»“

Windows â†’ ThinClientï¼šFreeRDP çš„ /sound å°±èƒ½å¸¦å›å£°éŸ³

Linux â†’ ThinClientï¼š

æ¨èç”¨ xrdp + FreeRDP /sound

è½»é‡çº§å¯ä»¥ç”¨ PulseAudio over TCP

å®æ—¶å¤šåª’ä½“å¯ç”¨ GStreamer RTP/WebRTC

ğŸ” æ’æŸ¥æ­¥éª¤
1. ç¡®è®¤å®‰è£…åŒ…å®Œæ•´

è¿è¡Œï¼š

sudo apt install pipewire wireplumber libspa-0.2-bluetooth libspa-0.2-jack -y

2. ç¡®è®¤ç”¨æˆ· systemd æ˜¯å¦å¯ç”¨
loginctl show-user $USER | grep Linger


å¦‚æœæ˜¾ç¤º Linger=noï¼Œå¯ç”¨ï¼š

sudo loginctl enable-linger $USER

3. æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•

ä¸ç”¨ enableï¼Œå…ˆå°è¯•ç›´æ¥è¿è¡Œï¼š

systemctl --user start pipewire.service
systemctl --user start wireplumber.service


å†æ£€æŸ¥çŠ¶æ€ï¼š

systemctl --user status pipewire.service
systemctl --user status wireplumber.service

4. éªŒè¯ PipeWire æ˜¯å¦å·¥ä½œ
pactl info | grep "Server Name"


æ­£å¸¸åº”æ˜¾ç¤ºï¼š

Server Name: PulseAudio (on PipeWire 0.3.x)
Sep 09 03:32:29 ubuntu systemd[3890]: wireplumber.service: Bound to unit pipewi>
Sep 09 03:32:29 ubuntu systemd[3890]: Dependency failed for wireplumber.service>
-- Subject: A start job for unit UNIT has failed
-- Defined-By: systemd
-- Support: http://www.ubuntu.com/support
--
-- A start job for unit UNIT has finished with a failure.
--
-- The job identifier is 176 and the job result is dependency.
Sep 09 03:32:29 ubuntu systemd[3890]: wireplumber.service: Job wireplumber.serv>

root@ubuntu:~# systemctl status  wireplumber
Unit wireplumber.service could not be found.
root@ubuntu:~# systemctl --user start wireplumber
A dependency job for wireplumber.service failed. See 'journalctl -xe' for detail                                                                                                                                                           s.
root@ubuntu:~# systemctl status pipewire
Unit pipewire.service could not be found.
root@ubuntu:~# systemctl status^Cipewire
root@ubuntu:~# systemctl --user start wireplumber
A dependency job for wireplumber.service failed. See 'journalctl -xe' for detail                                                                                                                                                           s.
root@ubuntu:~# systemctl --user start pipewire
root@ubuntu:~# systemctl --user status pipewire
* pipewire.service - PipeWire Multimedia Service
     Loaded: loaded (/usr/lib/systemd/user/pipewire.service; enabled; preset: en                                                                                                                                                           abled)
     Active: inactive (dead)
TriggeredBy: * pipewire.socket
  Condition: start condition unmet at Tue 2025-09-09 03:34:01 UTC; 6s ago
             `- ConditionUser=!root was not met

Sep 09 03:16:40 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:30:55 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:30:55 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:31:58 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:31:58 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:32:13 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:32:29 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:33:25 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:33:53 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).
Sep 09 03:34:01 ubuntu systemd[3890]: pipewire.service - PipeWire Multimedia Ser                                                                                                                                                           vice was skipped because of an unmet condition check (ConditionUser=!root).






[Unit]
Description=PipeWire Multimedia Service (Root)
After=sound.target network.target
Wants=network.target

[Service]
Type=simple
ExecStart=/usr/bin/pipewire
ExecStartPost=/usr/bin/wireplumber
Restart=on-failure
Environment=PIPEWIRE_LATENCY=128/48000
# å…è®¸ root ç”¨æˆ·å¯åŠ¨
User=root
Group=root

[Install]
WantedBy=multi-user.target




apt update
apt install --no-install-recommends \
    pipewire \
    wireplumber \
    libspa-0.2-modules \
    alsa-utils \
    -y
è¯´æ˜ï¼š

pipewire â†’ æ ¸å¿ƒæœåŠ¡

wireplumber â†’ ä¼šè¯ç®¡ç†å™¨

libspa-0.2-modules â†’ æä¾› ALSAã€PulseAudio å…¼å®¹æ¨¡å—

alsa-utils â†’ ç”¨äºæµ‹è¯•å£°éŸ³ï¼ˆspeaker-testã€aplayï¼‰

3ï¸âƒ£ è‡ªå®šä¹‰ systemd æœåŠ¡ï¼ˆroot ç”¨æˆ·ä¸“ç”¨ï¼‰
å› ä¸ºç˜¦å®¢æˆ·æœºé€šå¸¸åªæœ‰ rootï¼Œæ‰€ä»¥è¦å†™ä¸€ä¸ªè‡ªå®šä¹‰æœåŠ¡ï¼ˆè€Œä¸æ˜¯ --userï¼‰ã€‚

åˆ›å»º /etc/systemd/system/pipewire-root.serviceï¼š

ini
å¤åˆ¶ä»£ç 
[Unit]
Description=PipeWire Multimedia Service (Root)
After=sound.target network.target
Wants=network.target

[Service]
Type=simple
ExecStart=/usr/bin/pipewire
ExecStartPost=/usr/bin/wireplumber
Restart=on-failure
User=root
Group=root

[Install]
WantedBy=multi-user.target
å¯ç”¨ï¼š

bash
å¤åˆ¶ä»£ç 
systemctl daemon-reload
systemctl enable --now pipewire-root.service
















